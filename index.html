<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aurelo Data ‚Äî Grocery Store Dashboard</title>
<style>
  :root{
    --bg:#0b0b12;        /* near-black */
    --panel:#121223;     /* deep navy */
    --muted:#1a1a2b;
    --hover:#171732;
    --text:#f6f7fb;
    --sub:#b9b8ce;
    --brand:#7c4dff;     /* purple */
    --brand-2:#a78bfa;   /* soft purple */
    --accent:#2dd4bf;    /* teal accent for good KPIs */
    --warn:#f59e0b;      /* amber */
    --bad:#ef4444;       /* red */
    --good:#22c55e;      /* green */
    --chip:#2a2a45;
    --border:#232345;
    --shadow: 0 8px 24px rgba(0,0,0,.35);
    --radius: 16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#0a0a13 0%, #0c0c18 100%);
    color:var(--text); font: 14px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
  }
  a{color:inherit; text-decoration:none}
  .app{
    display:grid; grid-template-columns: 280px 1fr; min-height:100%;
  }
  /* Sidebar */
  .sidebar{
    position:sticky; top:0; height:100vh; overflow:auto;
    background:linear-gradient(200deg, rgba(124,77,255,.12), transparent 35%), var(--panel);
    border-right:1px solid var(--border); padding:18px;
  }
  .brand{
    display:flex; align-items:center; gap:12px; margin-bottom:18px;
  }
  .logo{
    width:44px; height:44px; border-radius:12px; background:radial-gradient(90px 90px at 30% 30%, var(--brand) 0%, #3b1f8f 50%, #111 100%);
    display:grid; place-items:center; box-shadow: inset 0 0 40px rgba(124,77,255,.35), 0 10px 22px rgba(0,0,0,.4);
    font-weight:800; letter-spacing:.5px;
  }
  .brand h1{font-size:16px; margin:0}
  .brand small{display:block; font-size:11px; color:var(--sub); letter-spacing:.3px}
  .nav{margin-top:8px; display:flex; flex-direction:column; gap:6px}
  .nav a{
    padding:10px 12px; border-radius:12px; color:var(--text);
    display:flex; align-items:center; gap:10px; border:1px solid transparent;
  }
  .nav a:hover{background:var(--hover); border-color:var(--border)}
  .nav a.active{background:linear-gradient(90deg, rgba(124,77,255,.18), transparent 90%); border-color:var(--brand); }
  .nav .tag{margin-left:auto; font-size:11px; background:var(--chip); padding:2px 8px; border-radius:999px; color:var(--sub); border:1px solid var(--border)}
  .sidebar .footer{
    margin-top:18px; padding-top:14px; border-top:1px dashed var(--border); color:var(--sub); font-size:12px;
  }

  /* Main */
  .main{display:flex; flex-direction:column; min-height:100vh}
  .topbar{
    position:sticky; top:0; z-index:5; background:rgba(12,12,24,.7); backdrop-filter: blur(10px);
    border-bottom:1px solid var(--border); padding:10px 16px; display:flex; align-items:center; gap:12px;
  }
  .search{
    flex:1; display:flex; gap:8px; align-items:center; background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:8px 10px;
  }
  .search input{
    flex:1; background:transparent; color:var(--text); border:0; outline:0; font-size:14px;
  }
  .btn, button{
    background:linear-gradient(180deg, var(--brand) 0%, #5c35ff 100%); border:0; color:white; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
    box-shadow: 0 8px 18px rgba(124,77,255,.25);
  }
  .btn.secondary{background:var(--chip); color:var(--text); border:1px solid var(--border); box-shadow:none; font-weight:500}
  .btn.ghost{background:transparent; border:1px solid var(--border); color:var(--sub); font-weight:500}
  .range{
    display:flex; gap:8px; align-items:center;
    background:var(--panel); border:1px solid var(--border); padding:6px 8px; border-radius:12px; color:var(--sub);
  }
  .content{padding:20px; display:grid; gap:14px}
  .grid{display:grid; gap:14px}
  .grid.cols-4{grid-template-columns: repeat(4, minmax(0,1fr))}
  .grid.cols-3{grid-template-columns: repeat(3, minmax(0,1fr))}
  .card{
    background:linear-gradient(180deg, rgba(124,77,255,.06), transparent 30%), var(--panel);
    border:1px solid var(--border); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow);
  }
  .card h3{margin:0 0 8px; font-size:14px; color:var(--sub); font-weight:600; letter-spacing:.3px}
  .kpi{
    display:flex; align-items:flex-end; justify-content:space-between; gap:8px;
  }
  .kpi .value{font-size:28px; font-weight:800; letter-spacing:.3px}
  .kpi .delta{font-size:12px; padding:2px 8px; border-radius:999px; background:var(--chip); border:1px solid var(--border); color:var(--sub)}
  .kpi .delta.good{color:var(--good); border-color:rgba(34,197,94,.4)}
  .kpi .delta.bad{color:var(--bad); border-color:rgba(239,68,68,.4)}
  .table{
    width:100%; border-collapse:separate; border-spacing:0; overflow:auto;
  }
  .table th, .table td{
    text-align:left; padding:10px; border-bottom:1px solid var(--border); white-space:nowrap;
  }
  .table th{
    font-size:12px; text-transform:uppercase; letter-spacing:.4px; color:var(--sub);
    position:sticky; top:0; background:linear-gradient(180deg, rgba(17,17,34,.7), rgba(17,17,34,.95));
    backdrop-filter: blur(8px); z-index:1;
  }
  .table tr:hover td{background:rgba(124,77,255,.06)}
  .chips{display:flex; gap:6px; flex-wrap:wrap}
  .chip{background:var(--chip); border:1px solid var(--border); padding:6px 10px; border-radius:999px; color:var(--sub); font-size:12px}
  .flex{display:flex; gap:10px; align-items:center}
  .row{display:flex; gap:14px; flex-wrap:wrap}
  .grow{flex:1}
  .spark{height:32px}
  .svgchart{width:100%; height:180px}
  .muted{color:var(--sub)}
  .pill{padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:var(--chip); font-size:11px; color:var(--sub)}
  .severity-high{color:#fff; background:linear-gradient(180deg, rgba(239,68,68,.9), rgba(239,68,68,.6)); border:0}
  .severity-med{color:#111; background:linear-gradient(180deg, rgba(245,158,11,.9), rgba(245,158,11,.6)); border:0}
  .severity-low{color:#07130c; background:linear-gradient(180deg, rgba(34,197,94,.9), rgba(34,197,94,.6)); border:0}
  .section-title{font-size:18px; margin:0 0 6px}
  .toolbar{display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:8px}
  .divider{height:1px; background:var(--border); margin:8px 0}
  .foot-note{font-size:12px; color:var(--sub)}
  .badge{padding:2px 6px; border:1px solid var(--border); border-radius:6px; font-size:11px; color:var(--sub); background:var(--chip)}
  .right{margin-left:auto}
  .hidden{display:none !important}
  /* Responsive */
  @media (max-width:1100px){ .grid.cols-4{grid-template-columns: repeat(2, minmax(0,1fr))} .app{grid-template-columns: 88px 1fr} .nav .txt{display:none} .brand small{display:none} }
  @media (max-width:720px){ .grid.cols-3{grid-template-columns:1fr} .grid.cols-4{grid-template-columns:1fr} .app{grid-template-columns:1fr} .sidebar{position:static; height:auto} .topbar{flex-wrap:wrap} }
</style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">AD</div>
      <div>
        <h1>Aurelo Data <small>Grocery OS</small></h1>
        <small>Store #204 ¬∑ Raleigh, NC</small>
      </div>
    </div>
    <nav class="nav" id="nav">
      <a href="#overview" data-route="overview" class="active"><span>üìä</span> <span class="txt">Overview</span></a>
      <a href="#prices" data-route="prices"><span>üè∑Ô∏è</span> <span class="txt">Prices</span> <span class="tag" id="priceBadge">12 recs</span></a>
      <a href="#inventory" data-route="inventory"><span>üì¶</span> <span class="txt">Inventory</span></a>
      <a href="#suppliers" data-route="suppliers"><span>ü§ù</span> <span class="txt">Suppliers</span></a>
      <a href="#customers" data-route="customers"><span>üßë‚Äçü§ù‚Äçüßë</span> <span class="txt">Customers</span></a>
      <a href="#promotions" data-route="promotions"><span>üéØ</span> <span class="txt">Promotions</span></a>
      <a href="#forecast" data-route="forecast"><span>üìà</span> <span class="txt">Forecast</span></a>
      <a href="#alerts" data-route="alerts"><span>üö®</span> <span class="txt">Alerts & Tasks</span> <span class="tag" id="alertBadge">3</span></a>
      <a href="#settings" data-route="settings"><span>‚öôÔ∏è</span> <span class="txt">Settings</span></a>
    </nav>
    <div class="footer">
      <div class="chips">
        <span class="chip">Microknots models</span>
        <span class="chip">RAG pricing engine</span>
        <span class="chip">Realtime POS</span>
      </div>
      <div style="margin-top:10px">¬© 2025 Aurelo Data</div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="search">
        <span>üîé</span>
        <input id="searchInput" placeholder="Search products, SKUs, suppliers, customers‚Ä¶" />
      </div>
      <div class="range">
        <span>üìÖ</span>
        <select id="rangeSelect">
          <option value="7">Last 7 days</option>
          <option value="14">Last 14 days</option>
          <option value="30" selected>Last 30 days</option>
          <option value="90">Last 90 days</option>
        </select>
      </div>
      <button class="btn secondary" id="exportBtn">Export CSV</button>
      <button class="btn ghost" id="themeBtn" title="Toggle contrast">üåó Theme</button>
      <button class="btn" id="refreshBtn">‚Üª Refresh</button>
    </header>

    <!-- CONTENT -->
    <section class="content" id="view"></section>
  </main>
</div>

<script>
/* ---------------------------
   Minimal util + mock engine
----------------------------*/
const fmt = {
  money:n=>"$"+(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}),
  int:n=>(n|0).toLocaleString(),
  pct:n=>(n>=0?"+":"")+(n*100).toFixed(1)+"%",
  date:d=>new Date(d).toLocaleDateString(),
};
const rand=(min,max)=>Math.random()*(max-min)+min;
const choice=a=>a[(Math.random()*a.length)|0];
const seeded = (seed=42)=>()=> (seed = (seed*16807)%2147483647)/2147483647;
const rng = seeded(204);

/* Mock catalogs & data */
const Departments = ["Produce","Dairy","Bakery","Meat","Seafood","Pantry","Frozen","Beverages","Snacks","Household","Personal Care","International"];
const Suppliers = ["GreenFields","NorthOcean","SunDairy","PrimeButchers","SweetBake","BlueRiver","Vista Produce","Marco Imports","Chill&Freeze","Sparkle Home","CarePlus"];

function generateProducts(count=120){
  const out=[];
  for(let i=0;i<count;i++){
    const dep=choice(Departments);
    const supplier=choice(Suppliers);
    const unitCost=+(rand(0.4,18.0)).toFixed(2);
    const margin=rand(0.18,0.42);
    const price=+(unitCost/(1-margin)).toFixed(2);
    const comp=+(price*rand(.9,1.1)).toFixed(2);
    const rec=+(comp*rand(.97,1.03)).toFixed(2);
    const sku="SKU-"+(100000+i);
    const stock=(rand(0,400))|0;
    const salesUnits=(rand(5,180))|0;
    const revenue=+(price*salesUnits).toFixed(2);
    const dos= stock/Math.max(salesUnits/30,1/30);
    out.push({
      sku, name: generateName(dep), department: dep, supplier,
      unitCost, price, competitor: comp, recPrice: rec,
      margin: (price-unitCost)/price,
      stock, reorderPoint: (rand(12,50))|0,
      salesUnits, revenue, last30: sparkData(30), dos,
      wasteRate: rand(0.00, dep==="Produce"||dep==="Bakery"?0.08:0.03),
      promoLift: rand(0.90,1.35)
    });
  }
  return out;
}
function generateName(dep){
  const base = {
    Produce:["Gala Apples","Bananas","Baby Spinach","Roma Tomatoes","Avocados"],
    Dairy:["Whole Milk","Greek Yogurt","Cheddar","Butter","Cottage Cheese"],
    Bakery:["Sourdough Loaf","Blueberry Muffins","Baguette","Croissant","Whole Wheat Bread"],
    Meat:["Chicken Breast","Ground Beef","Pork Chops","Turkey Slices","Bacon"],
    Seafood:["Salmon Fillet","Shrimp","Tilapia","Tuna Steaks","Crab Cakes"],
    Pantry:["Jasmine Rice","Black Beans","Olive Oil","Tomato Sauce","Pasta"],
    Frozen:["Frozen Pizza","Mixed Veggies","Ice Cream","Waffles","Chicken Nuggets"],
    Beverages:["Orange Juice","Cola 12pk","Cold Brew","Sparkling Water","Green Tea"],
    Snacks:["Potato Chips","Trail Mix","Chocolate Bar","Protein Bars","Pretzels"],
    Household:["Paper Towels","Laundry Detergent","Dish Soap","Trash Bags","Toilet Paper"],
    Personal Care:["Shampoo","Toothpaste","Lotion","Body Wash","Deodorant"],
    International:["Naan Bread","Curry Paste","Ramen Pack","Kimchi","Salsa Verde"]
  }[dep] || ["Item"];
  return choice(base);
}
function sparkData(n){
  const arr=[]; let base=rand(6,20);
  for(let i=0;i<n;i++){ base=Math.max(1, base + rand(-2.5,2.5)); arr.push(+base.toFixed(2)); }
  return arr;
}

let DB = {
  products: generateProducts(180),
  alerts: [
    {id:1, severity:"high", text:"Out-of-stock risk: Gala Apples < 1 day of supply", created:Date.now()-3600e3},
    {id:2, severity:"med", text:"Price anomaly: Whole Milk priced 9% above competitor", created:Date.now()-5*3600e3},
    {id:3, severity:"low", text:"Supplier GreenFields on-time rate 96% ‚Üë", created:Date.now()-86400e3},
  ],
  tasks: [
    {id:11, done:false, txt:"Approve 12 price recommendations"},
    {id:12, done:false, txt:"Send PO to Vista Produce"},
    {id:13, done:false, txt:"Schedule Weekend BOGO for Snacks"},
  ]
};

/* Simple hash router */
const routes = {
  overview: renderOverview,
  prices: renderPrices,
  inventory: renderInventory,
  suppliers: renderSuppliers,
  customers: renderCustomers,
  promotions: renderPromotions,
  forecast: renderForecast,
  alerts: renderAlerts,
  settings: renderSettings
};
function navigate(){
  const hash = (location.hash || "#overview").replace("#","");
  document.querySelectorAll('.nav a').forEach(a=>a.classList.toggle('active', a.dataset.route===hash));
  const view = document.getElementById('view');
  view.innerHTML = "";
  (routes[hash]||routes.overview)(view);
}
window.addEventListener('hashchange', navigate);

/* Search + export + theme */
const searchInput = document.getElementById('searchInput');
const rangeSelect = document.getElementById('rangeSelect');
searchInput.addEventListener('input', debounce(()=> { window._globalQuery = searchInput.value.trim().toLowerCase(); navigate(); }, 200));
rangeSelect.addEventListener('change', ()=>navigate());
document.getElementById('refreshBtn').addEventListener('click', ()=>{
  DB.products = generateProducts(180);
  toast("Data stream refreshed");
  navigate();
});
document.getElementById('themeBtn').addEventListener('click', ()=>{
  const was = getComputedStyle(document.documentElement).getPropertyValue('--bg').trim();
  if(was==="#0b0b12"){ // toggle to light
    document.documentElement.style.setProperty('--bg','#f6f7fb');
    document.documentElement.style.setProperty('--panel','#ffffff');
    document.documentElement.style.setProperty('--muted','#f0eff9');
    document.documentElement.style.setProperty('--hover','#f4f4ff');
    document.documentElement.style.setProperty('--text','#0d0d14');
    document.documentElement.style.setProperty('--sub','#51516a');
    document.documentElement.style.setProperty('--chip','#f4f4ff');
    document.documentElement.style.setProperty('--border','#e6e6fe');
  }else{ // back to dark
    document.location.reload(); // simplest reset of vars
  }
});
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const csv = toCSV(DB.products);
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement('a'), {href:url, download:`aurelo-grocery-${Date.now()}.csv`});
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* Helpers */
function debounce(fn,ms){let t;return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),ms)}}
function toCSV(rows){
  const cols = ["sku","name","department","supplier","unitCost","price","competitor","recPrice","margin","stock","reorderPoint","salesUnits","revenue","dos","wasteRate","promoLift"];
  const head = cols.join(",");
  const body = rows.map(r=>cols.map(k=>String(r[k]).replace(/,/g,"")).join(",")).join("\n");
  return head+"\n"+body;
}
function chip(txt){ return `<span class="chip">${txt}</span>` }
function pill(txt, cls=""){ return `<span class="pill ${cls}">${txt}</span>` }
function toast(msg){
  const el = document.createElement('div');
  el.textContent = msg;
  Object.assign(el.style, {position:'fixed', right:'16px', bottom:'16px', background:'rgba(17,17,34,.9)', padding:'10px 14px', border:'1px solid var(--border)', borderRadius:'12px', boxShadow:'var(--shadow)', zIndex:99});
  document.body.appendChild(el); setTimeout(()=>el.remove(), 2200);
}

/* Minimal SVG charts (no deps) */
function lineSVG(data, {w=520,h=180,p=16}={}){
  const min=Math.min(...data), max=Math.max(...data);
  const x=i=>p + i*( (w-2*p)/(data.length-1) );
  const y=v=> h-p - ( (v-min)/(max-min||1) )*(h-2*p);
  let d="M"+x(0)+","+y(data[0]);
  for(let i=1;i<data.length;i++){ d+=" L"+x(i)+","+y(data[i]); }
  const dots = data.map((v,i)=>`<circle cx="${x(i)}" cy="${y(v)}" r="2.6"/>`).join("");
  const grad = `linearGradient-${Math.random().toString(36).slice(2)}`;
  return `<svg class="svgchart" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
    <defs><linearGradient id="${grad}" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="var(--brand)"/><stop offset="100%" stop-color="transparent"/></linearGradient></defs>
    <path d="${d}" fill="none" stroke="var(--brand-2)" stroke-width="2"/>
    ${dots}
  </svg>`;
}
function barSVG(series, labels, {w=520,h=180,p=16}={}){
  const max = Math.max(...series, 10);
  const bw = (w-2*p)/series.length - 6;
  const bars = series.map((v,i)=>{
    const x = p + i*((w-2*p)/series.length);
    const hh = ((v/max)*(h-2*p));
    return `<rect x="${x}" y="${h-p-hh}" width="${bw}" height="${hh}" rx="6" ry="6" />`;
  }).join("");
  return `<svg class="svgchart" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
    <g fill="var(--brand-2)" opacity=".9">${bars}</g>
  </svg>`;
}
function sparkSVG(arr){
  const min=Math.min(...arr), max=Math.max(...arr), w=120,h=32,p=2;
  const x=i=>p + i*( (w-2*p)/(arr.length-1) );
  const y=v=> h-p - ( (v-min)/(max-min||1) )*(h-2*p);
  let d="M"+x(0)+","+y(arr[0]);
  for(let i=1;i<arr.length;i++){ d+=" L"+x(i)+","+y(arr[i]); }
  return `<svg class="spark" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
    <path d="${d}" fill="none" stroke="var(--accent)" stroke-width="2"/>
  </svg>`;
}

/* Filters */
function applyQuery(products){
  const q = (window._globalQuery||"").trim();
  if(!q) return products;
  return products.filter(p=>{
    const s = `${p.sku} ${p.name} ${p.department} ${p.supplier}`.toLowerCase();
    return q.split(/\s+/).every(tok=>s.includes(tok));
  });
}

/* ---------------------------
   Views
----------------------------*/
function renderOverview(root){
  const products = applyQuery(DB.products);
  // KPIs
  const revenue = products.reduce((a,b)=>a+b.revenue,0);
  const units = products.reduce((a,b)=>a+b.salesUnits,0);
  const oos = products.filter(p=>p.stock<=p.reorderPoint).length;
  const margin = products.reduce((a,b)=>a + (b.price-b.unitCost)*b.salesUnits,0) / Math.max(revenue,1);
  const ab = revenue / Math.max( (rand(850,1200)|0), 1);

  const head = document.createElement('div');
  head.innerHTML = `
  <div class="toolbar">
    <div>
      <h2 class="section-title">üìä Store Overview</h2>
      <div class="muted">Real-time view ¬∑ ${fmt.date(Date.now())}</div>
    </div>
    <div class="chips">
      ${chip("POS: Online")}
      ${chip("Inventory: Synced")}
      ${chip("Pricing Engine: Ready")}
    </div>
  </div>
  `;
  root.appendChild(head);

  const kpis = document.createElement('div');
  kpis.className="grid cols-4";
  kpis.innerHTML = `
    <div class="card"><h3>Revenue (MTD)</h3>
      <div class="kpi"><div class="value">${fmt.money(revenue)}</div><div class="delta good">${fmt.pct(rand(.03,.12))} vs prev</div></div>
    </div>
    <div class="card"><h3>Units Sold</h3>
      <div class="kpi"><div class="value">${fmt.int(units)}</div><div class="delta">${fmt.pct(rand(-.03,.06))}</div></div>
    </div>
    <div class="card"><h3>Avg Basket</h3>
      <div class="kpi"><div class="value">${fmt.money(ab)}</div><div class="delta good">${fmt.pct(rand(.01,.05))}</div></div>
    </div>
    <div class="card"><h3>Gross Margin</h3>
      <div class="kpi"><div class="value">${(margin*100).toFixed(1)}%</div><div class="delta ${margin>0.28?"good":"bad"}">${fmt.pct(margin-0.28)}</div></div>
    </div>
  `;
  root.appendChild(kpis);

  // Charts Row
  const r2 = document.createElement('div'); r2.className="grid cols-3";
  const last30 = sparkData(30).map((v,i)=> v* (1 + Math.sin(i/5)/8));
  const deptTotals = Departments.map(dep=> products.filter(p=>p.department===dep).reduce((a,b)=>a+b.revenue,0));
  const hours = Array.from({length:24},(_,h)=>({h, sales: rand(100,600)}));
  r2.innerHTML = `
    <div class="card">
      <h3>Revenue ‚Äî Last ${rangeSelect.value} Days</h3>
      ${lineSVG(last30)}
      <div class="foot-note">${pill("Model: Juniper Forecast v2")} ${pill("Confidence 92%","severity-low")}</div>
    </div>
    <div class="card">
      <h3>Sales by Department</h3>
      ${barSVG(deptTotals, Departments)}
      <div class="chips" style="margin-top:8px;">${Departments.slice(0,6).map(d=>chip(`${d}`)).join("")}</div>
    </div>
    <div class="card">
      <h3>Hourly Heat (today)</h3>
      <div class="row">
        ${hours.slice(7,22).map(o=> `<div class="chip" title="Hour ${o.h}:00">${String(o.h).padStart(2,"0")}:00 ¬∑ ${fmt.int(o.sales)}</div>`).join("")}
      </div>
      <div class="divider"></div>
      <div class="muted">Peak expected: 17:00‚Äì19:00 ¬∑ schedule front-end staff +1</div>
    </div>
  `;
  root.appendChild(r2);

  // Price recs preview
  const recs = products.filter(p=> Math.abs(p.recPrice - p.price)/p.price > 0.03).slice(0,10);
  document.getElementById('priceBadge').textContent = recs.length+" recs";
  const table = document.createElement('div'); table.className="card";
  table.innerHTML = `
    <div class="toolbar">
      <div><h3>Top Price Opportunities</h3></div>
      <div class="chips">
        ${chip("Elasticity-aware")}
        ${chip("Competitor indexed")}
        ${chip("MAP safe")}
        <a class="btn secondary" href="#prices">Review all</a>
      </div>
    </div>
    <div style="overflow:auto; max-height:320px; border-radius:12px; border:1px solid var(--border)">
      <table class="table">
        <thead><tr>
          <th>SKU</th><th>Product</th><th>Dept</th><th>Cur</th><th>Comp</th><th>Rec</th><th>Œî</th><th>Margin</th><th>Trend</th>
        </tr></thead>
        <tbody>
          ${recs.map(p=>{
            const diff = (p.recPrice - p.price)/p.price;
            return `<tr>
              <td>${p.sku}</td>
              <td>${p.name}</td>
              <td>${p.department}</td>
              <td>${fmt.money(p.price)}</td>
              <td>${fmt.money(p.competitor)}</td>
              <td><b>${fmt.money(p.recPrice)}</b></td>
              <td>${pill(fmt.pct(diff), diff>=0?"severity-low":"severity-med")}</td>
              <td>${(p.margin*100|0)}%</td>
              <td>${sparkSVG(p.last30)}</td>
            </tr>`
          }).join("")}
        </tbody>
      </table>
    </div>
  `;
  root.appendChild(table);

  // Alerts preview
  const alerts = document.createElement('div'); alerts.className="grid cols-3";
  document.getElementById('alertBadge').textContent = DB.alerts.length;
  alerts.innerHTML = DB.alerts.map(a=>`
    <div class="card">
      <h3>Alert ¬∑ ${new Date(a.created).toLocaleTimeString()}</h3>
      <div class="row"><span class="pill severity-${a.severity}">${a.severity.toUpperCase()}</span>
      <div>${a.text}</div></div>
      <div class="divider"></div>
      <div class="flex">
        <button class="btn secondary" onclick="ack(${a.id})">Acknowledge</button>
        <a class="btn ghost" href="#alerts">Open queue</a>
      </div>
    </div>
  `).join("");
  root.appendChild(alerts);
}

function renderPrices(root){
  const products = applyQuery(DB.products);
  const items = products
   .map(p=> ({...p, diff:(p.recPrice-p.price)/p.price}))
   .sort((a,b)=>Math.abs(b.diff)-Math.abs(a.diff));

  const header = document.createElement('div'); header.className="toolbar";
  header.innerHTML = `
    <div>
      <h2 class="section-title">üè∑Ô∏è Price Recommendations</h2>
      <div class="muted">Elasticity-aware, competitor-indexed, constraint-safe</div>
    </div>
    <div class="chips">
      ${chip("Floor/Ceiling rules")}
      ${chip("MAP aware")}
      ${chip("Psychological pricing")}
      <button class="btn" onclick="bulkApprove()">Approve All</button>
    </div>
  `;
  root.appendChild(header);

  const controls = document.createElement('div'); controls.className="row";
  controls.innerHTML = `
    <div class="chips">
      <label>Dept:</label>
      <select id="deptFilter" class="chip" onchange="navigate()">
        <option value="">All</option>
        ${Departments.map(d=>`<option>${d}</option>`).join("")}
      </select>
      <label>Œî threshold:</label>
      <select id="deltaFilter" class="chip" onchange="navigate()">
        <option value="0">All</option>
        <option value="0.02">2%+</option>
        <option value="0.05" selected>5%+</option>
        <option value="0.08">8%+</option>
      </select>
    </div>
    <div class="right">
      ${pill("Engine: Magenta Pricing v3")}
      ${pill("Explainer: SHAP")}
      ${pill("Confidence: 0.89")}
    </div>
  `;
  root.appendChild(controls);

  const deptSel = document.getElementById('deptFilter');
  const dth = parseFloat(document.getElementById('deltaFilter').value||"0");
  const filtered = items.filter(p=> (deptSel?.value? p.department===deptSel.value : true) && Math.abs(p.diff)>=dth );

  const tbl = document.createElement('div'); tbl.className="card";
  tbl.innerHTML = `
    <div style="overflow:auto; max-height:64vh; border-radius:12px; border:1px solid var(--border)">
      <table class="table">
        <thead>
          <tr><th>SKU</th><th>Product</th><th>Dept</th><th>Supplier</th><th>Unit Cost</th><th>Current</th><th>Competitor</th><th>Recommended</th><th>Œî</th><th>Mar%</th><th>DOS</th><th>Risk</th><th>Action</th></tr>
        </thead>
        <tbody>
          ${filtered.map(p=>{
            const risk = p.stock< p.reorderPoint ? "Low Stock" : (p.wasteRate>0.06? "Waste" : "Normal");
            return `<tr>
              <td>${p.sku}</td>
              <td>${p.name}</td>
              <td>${p.department}</td>
              <td>${p.supplier}</td>
              <td>${fmt.money(p.unitCost)}</td>
              <td>${fmt.money(p.price)}</td>
              <td>${fmt.money(p.competitor)}</td>
              <td><b>${fmt.money(p.recPrice)}</b></td>
              <td>${pill(fmt.pct((p.recPrice-p.price)/p.price), ((p.recPrice-p.price)>=0?"severity-low":"severity-med"))}</td>
              <td>${(p.margin*100|0)}%</td>
              <td>${(p.dos).toFixed(1)}</td>
              <td>${pill(risk, risk==="Low Stock"?"severity-med":(risk==="Waste"?"severity-med":""))}</td>
              <td><button class="btn secondary" onclick='approve("${p.sku}")'>Approve</button></td>
            </tr>`
          }).join("")}
        </tbody>
      </table>
    </div>
  `;
  root.appendChild(tbl);
}

function renderInventory(root){
  const products = applyQuery(DB.products).sort((a,b)=>a.stock - b.stock);
  const low = products.filter(p=>p.stock<=p.reorderPoint);
  const invHeader = document.createElement('div'); invHeader.className="toolbar";
  invHeader.innerHTML = `
    <div>
      <h2 class="section-title">üì¶ Inventory</h2>
      <div class="muted">${low.length} items at or below reorder point</div>
    </div>
    <div class="chips">
      ${chip("Cycle Count")}
      ${chip("FIFO")}
      <button class="btn" onclick="genPO()">Generate PO</button>
    </div>
  `;
  root.appendChild(invHeader);

  const inv = document.createElement('div'); inv.className="card";
  inv.innerHTML = `
    <div style="overflow:auto; max-height:64vh; border-radius:12px; border:1px solid var(--border)">
      <table class="table">
        <thead><tr><th>SKU</th><th>Name</th><th>Dept</th><th>Stock</th><th>Reorder</th><th>DOS</th><th>Waste%</th><th>Supplier</th><th>Last 30d</th><th>Action</th></tr></thead>
        <tbody>
          ${products.slice(0,120).map(p=>`
          <tr>
            <td>${p.sku}</td><td>${p.name}</td><td>${p.department}</td>
            <td>${fmt.int(p.stock)}</td><td>${fmt.int(p.reorderPoint)}</td>
            <td>${p.dos.toFixed(1)}</td><td>${(p.wasteRate*100).toFixed(1)}%</td>
            <td>${p.supplier}</td>
            <td>${sparkSVG(p.last30)}</td>
            <td><button class="btn secondary" onclick='reserve("${p.sku}")'>Reserve</button></td>
          </tr>`).join("")}
        </tbody>
      </table>
    </div>
  `;
  root.appendChild(inv);
}

function renderSuppliers(root){
  const bySupplier = {};
  for(const p of applyQuery(DB.products)){
    const s = (bySupplier[p.supplier] ||= {supplier:p.supplier, revenue:0, items:0, ontime:rand(.90,.99), fill:rand(.90,.99), lead:rand(2,7)});
    s.revenue += p.revenue; s.items++;
  }
  const arr = Object.values(bySupplier).sort((a,b)=>b.revenue-a.revenue);
  const head = document.createElement('div'); head.className="toolbar";
  head.innerHTML = `<div><h2 class="section-title">ü§ù Supplier Performance</h2>
  <div class="muted">Lead times, fill rates, on-time delivery, revenue impact</div></div>
  <div class="chips">${chip("SLA 95%")} ${chip("Chargebacks")} ${chip("Auto-PO")}</div>`;
  root.appendChild(head);

  const tbl = document.createElement('div'); tbl.className="card";
  tbl.innerHTML = `
    <table class="table">
      <thead><tr><th>Supplier</th><th>Items</th><th>Revenue</th><th>On-time</th><th>Fill</th><th>Lead (d)</th><th>Score</th><th>Action</th></tr></thead>
      <tbody>
      ${arr.map(s=>{
        const score = (s.ontime*0.5 + s.fill*0.4 + (1-s.lead/10)*0.1);
        return `<tr>
          <td>${s.supplier}</td>
          <td>${fmt.int(s.items)}</td>
          <td>${fmt.money(s.revenue)}</td>
          <td>${(s.ontime*100).toFixed(1)}%</td>
          <td>${(s.fill*100).toFixed(1)}%</td>
          <td>${s.lead.toFixed(1)}</td>
          <td>${pill((score*100).toFixed(0)+"%", score>0.9?"severity-low":(score<0.8?"severity-med":""))}</td>
          <td><button class="btn secondary" onclick='openContract("${s.supplier}")'>Open Contract</button></td>
        </tr>`
      }).join("")}
      </tbody>
    </table>
  `;
  root.appendChild(tbl);
}

function renderCustomers(root){
  // Simple cohort/segment mock
  const segments = [
    {name:"Budget Families", share:34, ab:42.1, freq:1.3, churn:8.5},
    {name:"Health Conscious", share:18, ab:31.9, freq:1.1, churn:6.1},
    {name:"Convenience Shoppers", share:22, ab:27.5, freq:0.9, churn:12.4},
    {name:"Foodies", share:10, ab:55.4, freq:0.8, churn:7.2},
    {name:"Loyalists", share:16, ab:48.2, freq:1.7, churn:3.8},
  ];
  const head = document.createElement('div'); head.className="toolbar";
  head.innerHTML = `<div><h2 class="section-title">üßë‚Äçü§ù‚Äçüßë Customers & Cohorts</h2>
  <div class="muted">Segments, basket analysis, retention</div></div>
  <div class="chips">${chip("Loyalty")} ${chip("CLV")} ${chip("RFM")}</div>`;
  root.appendChild(head);

  const grid = document.createElement('div'); grid.className="grid cols-3";
  grid.innerHTML = segments.map(s=>`
    <div class="card">
      <h3>${s.name}</h3>
      <div class="kpi"><div class="value">${s.share}%</div><div class="delta">${fmt.pct(rand(-.03,.06))}</div></div>
      <div class="chips">
        ${chip("Avg Basket "+fmt.money(s.ab))}
        ${chip("Freq "+s.freq+"/wk")}
        ${chip("Churn "+s.churn+"%")}
      </div>
      <div class="divider"></div>
      <div class="muted">Top Items: ${choice(Departments)} ¬∑ ${choice(Departments)} ¬∑ ${choice(Departments)}</div>
    </div>
  `).join("");
  root.appendChild(grid);

  const table = document.createElement('div'); table.className="card";
  const topSKUs = applyQuery(DB.products).sort((a,b)=>b.revenue-a.revenue).slice(0,15);
  table.innerHTML = `
    <h3>Basket Lift ‚Äî Cross-sell Pairs</h3>
    <table class="table">
      <thead><tr><th>Anchor</th><th>Pair</th><th>Support</th><th>Confidence</th><th>Lift</th><th>Action</th></tr></thead>
      <tbody>
        ${topSKUs.slice(0,10).map(a=>{
          const b = choice(topSKUs);
          return `<tr>
            <td>${a.name}</td><td>${b.name}</td>
            <td>${(rand(.06,.22)*100).toFixed(1)}%</td>
            <td>${(rand(.32,.78)*100).toFixed(1)}%</td>
            <td>${rand(1.05,1.8).toFixed(2)}√ó</td>
            <td><button class="btn secondary">Create Promo</button></td>
          </tr>`
        }).join("")}
      </tbody>
    </table>
  `;
  root.appendChild(table);
}

function renderPromotions(root){
  const head = document.createElement('div'); head.className="toolbar";
  head.innerHTML = `<div><h2 class="section-title">üéØ Promotions</h2>
  <div class="muted">A/B tests, lift, cannibalization guardrails</div></div>
  <div class="chips">${chip("BOGO")} ${chip("Mix & Match")} ${chip("Endcap")}</div>`;
  root.appendChild(head);

  const tests = Array.from({length:8}, (_,i)=>({
    id:i+1, name:`Test #${i+101}: ${choice(["BOGO Snacks","Milk Discount","Produce Bundle","Weekend Soda","Frozen Mix&Match"])}`,
    variantA: rand(1.00,1.20), variantB: rand(1.05,1.30), sig: rand(.75,.99), cann: rand(.85,1.05)
  }));
  const tbl = document.createElement('div'); tbl.className="card";
  tbl.innerHTML = `
    <table class="table">
      <thead><tr><th>Experiment</th><th>Lift A</th><th>Lift B</th><th>Significance</th><th>Cannibalization</th><th>Decision</th></tr></thead>
      <tbody>
        ${tests.map(t=> `<tr>
          <td>${t.name}</td>
          <td>${(t.variantA*100-100).toFixed(1)}%</td>
          <td>${(t.variantB*100-100).toFixed(1)}%</td>
          <td>${(t.sig*100).toFixed(0)}%</td>
          <td>${(t.cann*100-100).toFixed(1)}%</td>
          <td><button class="btn secondary">Roll ${t.variantB>t.variantA?"B":"A"}</button></td>
        </tr>`).join("")}
      </tbody>
    </table>
  `;
  root.appendChild(tbl);
}

function renderForecast(root){
  const head = document.createElement('div'); head.className="toolbar";
  head.innerHTML = `<div><h2 class="section-title">üìà Demand Forecast</h2>
  <div class="muted">Juniper Forecast v2 ¬∑ 7-day horizon</div></div>
  <div class="chips">${chip("Holt-Winters")} ${chip("Holiday adj.")} ${chip("Weather")}</div>`;
  root.appendChild(head);

  const items = applyQuery(DB.products).sort((a,b)=>b.salesUnits-a.salesUnits).slice(0,12);
  const grid = document.createElement('div'); grid.className="grid cols-3";
  grid.innerHTML = items.map(p=>{
    const base = p.salesUnits/7;
    const fc = Array.from({length:7}, (_,i)=> Math.max(0,(base*rand(.8,1.2))*(1+(i===5||i===6?0.15:0))));
    const total = fc.reduce((a,b)=>a+b,0);
    return `<div class="card">
      <h3>${p.name} <span class="badge">${p.sku}</span></h3>
      <div class="kpi"><div class="value">${fmt.int(total)} u</div><div class="delta">${fmt.pct(rand(-.06,.08))}</div></div>
      ${barSVG(fc,[],{w:520,h:160})}
      <div class="chips">${chip("Reorder @ "+fmt.int(p.reorderPoint))} ${chip("Stock "+fmt.int(p.stock))}</div>
    </div>`
  }).join("");
  root.appendChild(grid);
}

function renderAlerts(root){
  const head = document.createElement('div'); head.className="toolbar";
  head.innerHTML = `<div><h2 class="section-title">üö® Alerts & Tasks</h2>
  <div class="muted">Operational queue</div></div>
  <div class="chips">${chip("SLA 2h")} ${chip("Playbooks")}</div>`;
  root.appendChild(head);

  const list = document.createElement('div'); list.className="grid cols-3";
  list.innerHTML = DB.alerts.map(a=>`
    <div class="card">
      <div class="row"><span class="pill severity-${a.severity}">${a.severity.toUpperCase()}</span>
      <div>${a.text}</div></div>
      <div class="divider"></div>
      <button class="btn secondary" onclick="ack(${a.id})">Acknowledge</button>
    </div>
  `).join("");
  root.appendChild(list);

  const tasks = document.createElement('div'); tasks.className="card";
  tasks.innerHTML = `
    <h3>Tasks</h3>
    <div class="row">
      ${DB.tasks.map(t=> `<label class="chip"><input type="checkbox" ${t.done?"checked":""} onchange="toggleTask(${t.id})"> ${t.txt}</label>`).join("")}
    </div>
  `;
  root.appendChild(tasks);
}

function renderSettings(root){
  const c = document.createElement('div'); c.className="grid cols-3";
  c.innerHTML = `
    <div class="card">
      <h3>Brand</h3>
      <div class="chips">${chip("Aurelo Data")} ${chip("Microknots")}</div>
      <div class="divider"></div>
      <button class="btn secondary" onclick="location.hash='#overview'">Back to Overview</button>
    </div>
    <div class="card">
      <h3>Integrations</h3>
      <div class="chips">${chip("POS: Clover")} ${chip("ERP: NetSuite")} ${chip("Retail Media")}</div>
    </div>
    <div class="card">
      <h3>Explainability</h3>
      <p class="muted">Price engine uses SHAP to summarize top drivers per SKU: competitor index, margin floor, elasticity, MAP.</p>
    </div>
  `;
  root.appendChild(c);
}

/* Actions */
function approve(sku){
  const p = DB.products.find(x=>x.sku===sku); if(!p) return;
  p.price = p.recPrice; toast(`Approved new price for ${sku}`);
}
function bulkApprove(){
  const recs = DB.products.filter(p=> Math.abs((p.recPrice-p.price)/p.price) >= 0.05 );
  recs.forEach(p=> p.price = p.recPrice );
  toast(`Approved ${recs.length} price updates`);
  navigate();
}
function reserve(sku){ toast(`Reserved stock for ${sku}`) }
function genPO(){ toast("PO generated for low-stock items") }
function openContract(s){ toast(`Opening contract: ${s}`) }
function ack(id){ DB.alerts = DB.alerts.filter(a=>a.id!==id); toast("Alert acknowledged"); navigate(); }
function toggleTask(id){ const t=DB.tasks.find(x=>x.id===id); if(t){ t.done=!t.done; } }

/* Init */
navigate();
</script>
</body>
</html>

